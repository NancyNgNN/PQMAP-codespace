version: '3.8'
services:
  backend:
    build: .
    image: pqmap-dev:py311
    container_name: pqmap-backend
    env_file: .env
    environment:
      # UVICORN_APP should be in form module:app (default tries main:app)
      UVICORN_APP: "main:app"
      PYTHONUNBUFFERED: "1"
    volumes:
      - ./:/app:cached
    ports:
      - "8000:8000"
    command: ["/app/scripts/backend_start.sh"]

  frontend:
    image: node:18
    container_name: pqmap-frontend
    working_dir: /workspace
    volumes:
      - ./:/workspace:cached
    environment:
      CHOKIDAR_USEPOLLING: "true"
    ports:
      - "5173:5173"
    command: ["bash", "-lc", "npm ci && npm run dev -- --host 0.0.0.0 --port 5173"]
