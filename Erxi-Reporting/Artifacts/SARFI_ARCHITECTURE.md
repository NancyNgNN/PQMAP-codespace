# SARFI Configuration - Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    SARFI Dashboard                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  SARFIChart.tsx                               [âš™ï¸ Config]â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Chart: SARFI-70, SARFI-80, SARFI-90 Trends     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - Monthly aggregation                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - Weighted by profile factors                   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  SARFIDataTable.tsx (Conditional)                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Meter No â”‚ Location â”‚ S10 â”‚ S30 â”‚... â”‚ Weight     â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ PQM-001  â”‚ TST      â”‚  5  â”‚  3  â”‚... â”‚  2.5000    â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ PQM-002  â”‚ CWB      â”‚  8  â”‚  4  â”‚... â”‚  1.8500    â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SARFIConfigModal.tsx (Overlay)                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Filters:                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Profile: [2023 â–¼] [2024 â–¼] [2025 âœ“]                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Voltage Level: [11kV â–¼]                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Exclude Special Events: [âœ“]                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Data Type: [Magnitude] [Duration]                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Show Data Table: [âœ“]                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [Cancel]  [Apply Filters]                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SARFIProfileManagement.tsx (Admin Only)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Profiles        â”‚  â”‚ Weighting Factors                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ 2023 [âœï¸][ğŸ—‘ï¸] â”‚ â”‚  â”‚ â”‚ Meter    â”‚ Weight â”‚ Actions â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ 2024 [âœï¸][ğŸ—‘ï¸] â”‚ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ 2025 âœ“[âœï¸][ğŸ—‘ï¸]â”‚ â”‚  â”‚ â”‚ PQM-001  â”‚ 2.5000 â”‚   [âœï¸]   â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚ PQM-002  â”‚ 1.8500 â”‚   [âœï¸]   â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ [+]             â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SERVICE LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  sarfiService.ts                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Profile Management:                                          â”‚  â”‚
â”‚  â”‚  â€¢ fetchSARFIProfiles()      â†’ Get all profiles              â”‚  â”‚
â”‚  â”‚  â€¢ fetchActiveProfile(year)   â†’ Get active profile           â”‚  â”‚
â”‚  â”‚  â€¢ createSARFIProfile()       â†’ Create new profile           â”‚  â”‚
â”‚  â”‚  â€¢ updateSARFIProfile()       â†’ Modify profile               â”‚  â”‚
â”‚  â”‚  â€¢ deleteSARFIProfile()       â†’ Remove profile               â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Weight Management:                                            â”‚  â”‚
â”‚  â”‚  â€¢ fetchProfileWeights()      â†’ Get weights for profile      â”‚  â”‚
â”‚  â”‚  â€¢ upsertProfileWeight()      â†’ Add/update weight            â”‚  â”‚
â”‚  â”‚  â€¢ batchUpdateWeights()       â†’ Update multiple weights      â”‚  â”‚
â”‚  â”‚  â€¢ deleteProfileWeight()      â†’ Remove weight                â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  Data Retrieval:                                              â”‚  â”‚
â”‚  â”‚  â€¢ fetchFilteredSARFIData()   â†’ Get filtered SARFI data      â”‚  â”‚
â”‚  â”‚  â€¢ calculateWeightedSARFI()   â†’ Calculate weighted indices   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  sarfi_profiles                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ id â”‚ name        â”‚ year â”‚ is_activeâ”‚ created_atâ”‚ ... â”‚ â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤ â”‚    â”‚
â”‚  â”‚  â”‚ 1  â”‚ 2023 Std    â”‚ 2023 â”‚  false   â”‚ ...       â”‚ ... â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ 2  â”‚ 2024 Std    â”‚ 2024 â”‚  false   â”‚ ...       â”‚ ... â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ 3  â”‚ 2025 Std    â”‚ 2025 â”‚  true    â”‚ ...       â”‚ ... â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â†“ (1:N)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  sarfi_profile_weights                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ id â”‚ profile_id â”‚ meter_id â”‚ weight_factor â”‚ notes   â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚ 1  â”‚     3      â”‚  PQM-001 â”‚    2.5000     â”‚ Auto    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ 2  â”‚     3      â”‚  PQM-002 â”‚    1.8500     â”‚ Auto    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ 3  â”‚     3      â”‚  PQM-003 â”‚    3.2000     â”‚ Auto    â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â”‚  Relationships:                                                      â”‚
â”‚  â€¢ sarfi_profiles â†’ sarfi_profile_weights (1:N)                     â”‚
â”‚  â€¢ sarfi_profile_weights â†’ pq_meters (N:1)                          â”‚
â”‚  â€¢ Cascade delete: Deleting profile removes all weights             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### 1. Filter Application Flow

```
User Action                Service Layer              Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€

[Click âš™ï¸]
    â”‚
    â”œâ”€â†’ Open Modal
    â”‚       â”‚
    â”‚       â”œâ”€â†’ Load Profiles    â†’ fetchSARFIProfiles()  â†’ SELECT * FROM sarfi_profiles
    â”‚       â”‚                                                         â†“
    â”‚       â”‚                      â† Return profiles[]  â† [2023, 2024, 2025]
    â”‚       â”‚
    â”‚   [Select Profile: 2025]
    â”‚   [Select Voltage: 11kV]
    â”‚   [Toggle: Exclude Special]
    â”‚   [Toggle: Show Table]
    â”‚       â”‚
    â”‚   [Click Apply]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ Save to localStorage
    â”‚       â”‚       (sarfi_filters)
    â”‚       â”‚
    â”‚       â”œâ”€â†’ fetchFilteredSARFIData()  â†’ Complex Query:
    â”‚       â”‚                                 â€¢ JOIN pq_events + meters
    â”‚       â”‚                                 â€¢ Filter by voltage_level = '11kV'
    â”‚       â”‚                                 â€¢ Filter is_special_event = false
    â”‚       â”‚                                 â€¢ Group by meter_id
    â”‚       â”‚                                         â†“
    â”‚       â”‚        â† Return events[]     â† [Raw event data]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ fetchProfileWeights()     â†’ SELECT * FROM sarfi_profile_weights
    â”‚       â”‚                                 WHERE profile_id = '2025'
    â”‚       â”‚                                         â†“
    â”‚       â”‚        â† Return weights[]    â† [meter_id, weight_factor]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ Process data locally:
    â”‚       â”‚   â€¢ Group events by meter
    â”‚       â”‚   â€¢ Calculate SARFI indices
    â”‚       â”‚   â€¢ Apply weight factors
    â”‚       â”‚
    â”‚   [Update Chart]
    â”‚   [Show Data Table]
    â”‚
[View Updated Dashboard]
```

### 2. Profile Management Flow

```
Admin Action              Service Layer              Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€

[Navigate to Profile Mgmt]
    â”‚
    â”œâ”€â†’ Load initial data
    â”‚       â”‚
    â”‚       â”œâ”€â†’ fetchSARFIProfiles()   â†’ SELECT * FROM sarfi_profiles
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Return profiles[]   â† [All profiles]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ fetchMeters()          â†’ SELECT * FROM pq_meters
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Return meters[]     â† [All meters]
    â”‚
[Click Create Profile]
    â”‚
    â”œâ”€â†’ [Enter: "2026 Test", 2026]
    â”‚       â”‚
    â”‚   [Click Save]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ createSARFIProfile()   â†’ INSERT INTO sarfi_profiles
    â”‚       â”‚                              VALUES (name, year, ...)
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Return new_profile  â† [Created profile]
    â”‚       â”‚
    â”‚   [Success notification]
    â”‚
[Select Profile]
    â”‚
    â”œâ”€â†’ Load weights for profile
    â”‚       â”‚
    â”‚       â”œâ”€â†’ fetchProfileWeights()  â†’ SELECT * FROM sarfi_profile_weights
    â”‚       â”‚                              WHERE profile_id = '...'
    â”‚       â”‚                              JOIN pq_meters
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Return weights[]    â† [Weights with meter info]
    â”‚       â”‚
    â”‚   [Display weights table]
    â”‚
[Click Edit Weight]
    â”‚
    â”œâ”€â†’ [Change value: 2.5 â†’ 3.0]
    â”‚       â”‚
    â”‚   [Press Enter]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ upsertProfileWeight()  â†’ UPDATE sarfi_profile_weights
    â”‚       â”‚                              SET weight_factor = 3.0
    â”‚       â”‚                              WHERE id = '...'
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Success             â† [Updated]
    â”‚       â”‚
    â”‚   [Update UI]
    â”‚
[Click Delete Profile]
    â”‚
    â”œâ”€â†’ [Confirm dialog]
    â”‚       â”‚
    â”‚   [Click Yes]
    â”‚       â”‚
    â”‚       â”œâ”€â†’ deleteSARFIProfile()   â†’ DELETE FROM sarfi_profiles
    â”‚       â”‚                              WHERE id = '...'
    â”‚       â”‚                              (CASCADE deletes weights)
    â”‚       â”‚                                         â†“
    â”‚       â”‚   â† Success             â† [Deleted]
    â”‚       â”‚
    â”‚   [Remove from list]
```

### 3. SARFI Calculation Flow

```
Input Data                Processing                Output
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€

PQ Events                                          Weighted SARFI
â”œâ”€ Event 1: 85% voltage  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Event 2: 65% voltage  â”‚ 1. Group by meter     â”‚  Chart Data
â”œâ”€ Event 3: 40% voltage  â”‚    - PQM-001: 5 eventsâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Event 4: 25% voltage  â”‚    - PQM-002: 3 eventsâ”‚  â”‚ SARFI-70: 5.2â”‚
â””â”€ Event 5: 15% voltage  â”‚    - PQM-003: 8 eventsâ”‚  â”‚ SARFI-80: 3.1â”‚
                         â”‚                        â”‚  â”‚ SARFI-90: 1.5â”‚
Profile Weights          â”‚ 2. Calculate indices  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€ PQM-001: 2.5         â”‚    For each meter:     â”‚
â”œâ”€ PQM-002: 1.8         â”‚    â€¢ Count by voltage  â”‚  Table Data
â””â”€ PQM-003: 3.0         â”‚      threshold         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
                         â”‚                        â”‚  â”‚Meter  â”‚S70 â”‚Wgt â”‚
Filters                  â”‚ 3. Apply filters      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”œâ”€ Voltage: 11kV        â”‚    â€¢ Filter voltage    â”‚  â”‚PQM-001â”‚ 5  â”‚2.5 â”‚
â”œâ”€ Exclude: true        â”‚    â€¢ Remove special    â”‚  â”‚PQM-002â”‚ 3  â”‚1.8 â”‚
â””â”€ Profile: 2025        â”‚    â€¢ Apply weights     â”‚  â”‚PQM-003â”‚ 8  â”‚3.0 â”‚
                         â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
                         â”‚ 4. Weighted average   â”‚
                         â”‚    SARFI = Î£(nÃ—w) / Î£wâ”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Component State                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  SARFIChart                                                  â”‚
â”‚  â”œâ”€ filters: SARFIFilters          (from localStorage)      â”‚
â”‚  â”œâ”€ isConfigOpen: boolean          (modal visibility)       â”‚
â”‚  â””â”€ tableData: SARFIDataPoint[]    (computed from filters)  â”‚
â”‚                                                               â”‚
â”‚  SARFIConfigModal                                            â”‚
â”‚  â”œâ”€ localFilters: SARFIFilters     (temp state)             â”‚
â”‚  â””â”€ profiles: SARFIProfile[]       (loaded on mount)        â”‚
â”‚                                                               â”‚
â”‚  SARFIProfileManagement                                      â”‚
â”‚  â”œâ”€ profiles: SARFIProfile[]       (all profiles)           â”‚
â”‚  â”œâ”€ selectedProfile: SARFIProfile  (for weight editing)     â”‚
â”‚  â”œâ”€ weights: SARFIProfileWeight[]  (for selected)           â”‚
â”‚  â”œâ”€ meters: PQMeter[]              (all meters)             â”‚
â”‚  â”œâ”€ editingWeight: string          (ID being edited)        â”‚
â”‚  â””â”€ loading: boolean               (async operations)       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Persistent Storage                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  localStorage                                                â”‚
â”‚  â””â”€ sarfi_filters: JSON            (user preferences)       â”‚
â”‚                                                               â”‚
â”‚  Database (Supabase)                                         â”‚
â”‚  â”œâ”€ sarfi_profiles                 (profile definitions)    â”‚
â”‚  â””â”€ sarfi_profile_weights          (weight factors)         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
App
â””â”€â”€ Dashboard
    â””â”€â”€ SARFIChart
        â”œâ”€â”€ Chart Visualization
        â”‚   â”œâ”€â”€ Bar charts (SARFI-70/80/90)
        â”‚   â””â”€â”€ Summary statistics
        â”‚
        â”œâ”€â”€ SARFIConfigModal (conditional)
        â”‚   â”œâ”€â”€ Profile dropdown
        â”‚   â”œâ”€â”€ Voltage level select
        â”‚   â”œâ”€â”€ Toggle switches
        â”‚   â””â”€â”€ Action buttons
        â”‚
        â””â”€â”€ SARFIDataTable (conditional)
            â”œâ”€â”€ Table header
            â”œâ”€â”€ Data rows
            â””â”€â”€ Footer totals

Settings
â””â”€â”€ SARFIProfileManagement
    â”œâ”€â”€ Profile List Panel
    â”‚   â”œâ”€â”€ Create profile form
    â”‚   â””â”€â”€ Profile cards
    â”‚
    â””â”€â”€ Weights Editor Panel
        â”œâ”€â”€ Weights table
        â””â”€â”€ Inline editors
```

This architecture provides a clean separation of concerns with:
- **UI Layer**: React components for display and interaction
- **Service Layer**: Business logic and API calls
- **Database Layer**: Persistent storage with RLS security
